<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chi·∫øn Sƒ© Kh√°ng Chi·∫øn - T∆∞ T∆∞·ªüng H·ªì Ch√≠ Minh</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(45deg, #2c3e50, #34495e, #27ae60);
            background-size: 400% 400%;
            animation: battlefieldMove 15s ease infinite;
            min-height: 100vh;
            overflow: hidden;
            user-select: none;
        }
        @keyframes battlefieldMove {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        .game-container {
            position: relative;
            width: 100vw;
            height: 100vh;
            background: radial-gradient(ellipse at center, rgba(0,0,0,0.1) 0%, rgba(0,0,0,0.3) 100%);
        }
        .hud {
            position: fixed;
            top: 20px;
            left: 20px;
            right: 20px;
            z-index: 1000;
            display: flex;
            justify-content: space-between;
            align-items: center;
            pointer-events: none;
            gap: 12px;
        }
        .stat-panel {
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 15px 20px;
            border-radius: 15px;
            border: 2px solid #e74c3c;
            backdrop-filter: blur(10px);
            pointer-events: auto;
        }
        .health-bar, .spirit-bar {
            width: 200px;
            height: 20px;
            background: rgba(255,255,255,0.2);
            border-radius: 10px;
            margin: 5px 0;
            overflow: hidden;
            border: 1px solid #fff;
        }
        .health-fill {
            height: 100%;
            background: linear-gradient(90deg, #e74c3c, #c0392b);
            transition: width 0.3s ease;
            border-radius: 10px;
        }
        .spirit-fill {
            height: 100%;
            background: linear-gradient(90deg, #f1c40f, #f39c12);
            transition: width 0.3s ease;
            border-radius: 10px;
        }
        .battlefield {
            position: absolute;
            width: 100%;
            height: 100%;
            background-image:
                radial-gradient(circle at 20% 20%, rgba(46, 125, 50, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(139, 69, 19, 0.3) 0%, transparent 50%);
        }
        .player {
            position: absolute;
            width: 50px;
            height: 50px;
            font-size: 40px;
            transition: none;
            z-index: 100;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            filter: drop-shadow(0 0 10px rgba(255,255,255,0.3));
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .enemy {
            position: absolute;
            width: 40px;
            height: 40px;
            font-size: 35px;
            z-index: 50;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
            filter: drop-shadow(0 0 8px rgba(255,0,0,0.5));
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .boss-enemy {
            position: absolute;
            width: 80px;
            height: 80px;
            font-size: 70px;
            z-index: 60;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.9);
            filter: drop-shadow(0 0 20px rgba(255,0,0,0.8));
            display: flex;
            align-items: center;
            justify-content: center;
            animation: bossPulse 2s ease-in-out infinite;
        }
        @keyframes bossPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        .bullet {
            position: absolute;
            width: 8px;
            height: 8px;
            background: radial-gradient(circle, #ffff00, #ff6b00);
            border-radius: 50%;
            z-index: 75;
            box-shadow: 0 0 10px #ffff00;
        }
        .enemy-bullet {
            position: absolute;
            width: 6px;
            height: 6px;
            background: radial-gradient(circle, #ff0000, #8b0000);
            border-radius: 50%;
            z-index: 75;
            box-shadow: 0 0 8px #ff0000;
        }
        .boss-bullet {
            position: absolute;
            width: 12px;
            height: 12px;
            background: radial-gradient(circle, #ff00ff, #800080);
            border-radius: 50%;
            z-index: 75;
            box-shadow: 0 0 15px #ff00ff;
        }
        .explosion {
            position: absolute;
            font-size: 60px;
            z-index: 200;
            animation: explode 0.5s ease-out forwards;
            pointer-events: none;
        }
        @keyframes explode {
            0% { transform: scale(0.1); opacity: 1; }
            100% { transform: scale(2); opacity: 0; }
        }
        .question-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.95);
            color: white;
            padding: 30px;
            border-radius: 20px;
            border: 3px solid #e74c3c;
            z-index: 2000;
            max-width: 900px;
            width: 95%;
            backdrop-filter: blur(15px);
        }
        .question-text {
            font-size: 1.2em;
            margin-bottom: 20px;
            text-align: center;
            color: #ecf0f1;
            line-height: 1.4;
        }
        .difficulty-indicator {
            text-align: center;
            margin-bottom: 15px;
            font-size: 1.1em;
            font-weight: bold;
        }
        .difficulty-easy { color: #2ecc71; }
        .difficulty-medium { color: #f39c12; }
        .difficulty-hard { color: #e74c3c; }
        .difficulty-expert { color: #9b59b6; }
        .difficulty-nightmare { color: #ff0066; }
        .answer-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }
        .answer-btn {
            background: linear-gradient(45deg, #3498db, #2980b9);
            color: white;
            border: none;
            padding: 15px;
            border-radius: 10px;
            font-size: 0.95em;
            cursor: pointer;
            transition: all 0.3s ease;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            line-height: 1.3;
        }
        .answer-btn:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(52, 152, 219, 0.4); }
        .answer-btn.correct { background: linear-gradient(45deg, #27ae60, #2ecc71); }
        .answer-btn.incorrect { background: linear-gradient(45deg, #e74c3c, #c0392b); }
        .instructions {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 15px;
            border-radius: 10px;
            font-size: 0.9em;
            backdrop-filter: blur(10px);
            pointer-events: none;
        }
        .wave-indicator {
            position: fixed;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            font-size: 3em; color: #e74c3c; font-weight: bold;
            z-index: 1500; text-shadow: 3px 3px 6px rgba(0,0,0,0.8);
            animation: waveAnnounce 2s ease-out forwards;
            pointer-events: none;
        }
        @keyframes waveAnnounce {
            0% { opacity: 0; transform: translate(-50%, -50%) scale(0.5); }
            50% { opacity: 1; transform: translate(-50%, -50%) scale(1.2); }
            100% { opacity: 0; transform: translate(-50%, -50%) scale(1); }
        }
        .game-over-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9); display: none; justify-content: center; align-items: center;
            z-index: 3000; backdrop-filter: blur(15px);
        }
        .game-over-content {
            text-align: center; color: white; background: rgba(231, 76, 60, 0.2);
            padding: 40px; border-radius: 20px; border: 3px solid #e74c3c;
        }
        .restart-btn {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
            color: white; border: none; padding: 15px 30px; border-radius: 25px;
            font-size: 1.1em; cursor: pointer; margin-top: 20px; transition: all 0.3s ease;
        }
        .explanation { margin-top: 15px; padding: 15px; background: rgba(255,255,255,0.1); border-radius: 10px; display: none; }
        #toggle-sound { pointer-events: auto; cursor: pointer; padding: 8px 14px; border-radius: 10px; border: 1px solid #fff; background: #2ecc71; color: #fff; }
        #volume { pointer-events: auto; cursor: pointer; }
        .timer-bar {
            width: 100%;
            height: 8px;
            background: rgba(255,255,255,0.2);
            border-radius: 4px;
            margin-top: 10px;
            overflow: hidden;
        }
        .timer-fill {
            height: 100%;
            background: linear-gradient(90deg, #e74c3c, #f39c12);
            transition: width 0.1s linear;
            border-radius: 4px;
        }
    </style>
</head>
<body>
<div class="game-container">
    <div class="hud">
        <div class="stat-panel">
            <div>üáªüá≥ Chi·∫øn Sƒ© Kh√°ng Chi·∫øn</div>
            <div class="health-bar"><div class="health-fill" id="health-bar"></div></div>
            <div>M√°u: <span id="health-text">100</span></div>
        </div>

        <div style="text-align: center; color: white; font-size: 1.5em; text-shadow: 2px 2px 4px rgba(0,0,0,0.8);">
            <div>üèÜ ƒêi·ªÉm: <span id="score">0</span></div>
            <div>‚ö° L√†n: <span id="wave">1</span></div>
            <div>üéØ ƒê·ªô kh√≥: <span id="difficulty-level">D·ªÖ</span></div>
        </div>

        <div class="stat-panel">
            <div>üí™ Tinh Th·∫ßn C√°ch M·∫°ng</div>
            <div class="spirit-bar"><div class="spirit-fill" id="spirit-bar"></div></div>
            <div>NƒÉng l∆∞·ª£ng: <span id="spirit-text">100</span></div>
        </div>

        <div class="stat-panel" style="display:flex;align-items:center;gap:10px;">
            <button id="toggle-sound">üîä Enable Sound</button>
            <div style="color:#fff;">Vol</div>
            <input id="volume" type="range" min="0" max="1" step="0.01" value="0.6">
        </div>
    </div>

    <div class="battlefield" id="battlefield">
        <div class="player" id="player">ü™ñ</div>
    </div>

    <div class="instructions">
        <strong>ƒêi·ªÅu khi·ªÉn:</strong><br>
        ‚å®Ô∏è WASD ho·∫∑c ‚Üê‚Üí‚Üë‚Üì: Di chuy·ªÉn<br>
        üñ±Ô∏è Click chu·ªôt: B·∫Øn ƒë·∫°n<br>
        üí° Tr·∫£ l·ªùi ƒë√∫ng c√¢u h·ªèi ƒë·ªÉ ƒë∆∞·ª£c buff!<br>
        ‚è∞ C√¢u h·ªèi c√≥ gi·ªõi h·∫°n th·ªùi gian!<br>
        üî• Boss xu·∫•t hi·ªán t·ª´ l√†n 10!<br>
        üìà ƒê·ªô kh√≥ tƒÉng theo ƒëi·ªÉm: 500, 1000, 2000, 3500
    </div>

    <div class="question-popup" id="question-popup" style="display: none;">
        <div class="difficulty-indicator" id="difficulty-indicator"></div>
        <div class="question-text" id="question-text"></div>
        <div class="timer-bar">
            <div class="timer-fill" id="timer-fill"></div>
        </div>
        <div class="answer-options" id="answer-options"></div>
        <div class="explanation" id="explanation"></div>
    </div>

    <div class="game-over-screen" id="game-over">
        <div class="game-over-content">
            <h1>üáªüá≥ K·∫øt Th√∫c Nhi·ªám V·ª•! üáªüá≥</h1>
            <div style="font-size: 1.5em; margin: 20px 0;">
                ƒêi·ªÉm cu·ªëi: <span id="final-score">0</span><br>
                L√†n ƒë·∫°t ƒë∆∞·ª£c: <span id="final-wave">1</span><br>
                ƒê·ªô kh√≥ cao nh·∫•t: <span id="final-difficulty">D·ªÖ</span>
            </div>
            <p>B·∫°n ƒë√£ chi·∫øn ƒë·∫•u d≈©ng c·∫£m v√¨ t∆∞ t∆∞·ªüng H·ªì Ch√≠ Minh!</p>
            <button class="restart-btn" onclick="restartGame()">üîÑ Chi·∫øn ƒê·∫•u L·∫°i</button>
        </div>
    </div>
</div>

<script>
/* ====================== Sound Manager (Web Audio API) ====================== */
class SoundManager {
  constructor() {
    this.ctx = null;
    this.master = null;
    this.enabled = false;
    this.volume = 0.6;
    this._bgmTimer = null;
  }
  init() {
    if (this.enabled) return;
    const AudioContext = window.AudioContext || window.webkitAudioContext;
    if (!AudioContext) return;
    this.ctx = new AudioContext();
    this.master = this.ctx.createGain();
    this.master.gain.value = this.volume;
    this.master.connect(this.ctx.destination);
    this.enabled = true;
    if (this.ctx.state === "suspended") this.ctx.resume();
  }
  setVolume(v) {
    this.volume = v;
    if (this.master) this.master.gain.value = v;
  }
  _tone({ freq=440, type="square", dur=0.08, attack=0.002, decay=0.06, vol=0.8 }) {
    if (!this.enabled) return;
    const t0 = this.ctx.currentTime;
    const osc = this.ctx.createOscillator();
    const gain = this.ctx.createGain();
    osc.type = type;
    osc.frequency.setValueAtTime(freq, t0);
    gain.gain.setValueAtTime(0, t0);
    gain.gain.linearRampToValueAtTime(vol, t0 + attack);
    gain.gain.exponentialRampToValueAtTime(0.0001, t0 + attack + decay);
    osc.connect(gain).connect(this.master);
    osc.start(t0);
    osc.stop(t0 + attack + decay + 0.02);
  }
  _noise({ dur=0.25, vol=0.5, lp=1200 }) {
    if (!this.enabled) return;
    const t0 = this.ctx.currentTime;
    const bufferSize = Math.floor(this.ctx.sampleRate * dur);
    const buffer = this.ctx.createBuffer(1, bufferSize, this.ctx.sampleRate);
    const data = buffer.getChannelData(0);
    for (let i = 0; i < bufferSize; i++) data[i] = (Math.random() * 2 - 1) * 0.9;
    const src = this.ctx.createBufferSource();
    src.buffer = buffer;
    const filter = this.ctx.createBiquadFilter();
    filter.type = "lowpass";
    filter.frequency.value = lp;
    const gain = this.ctx.createGain();
    gain.gain.setValueAtTime(vol, t0);
    gain.gain.exponentialRampToValueAtTime(0.0001, t0 + dur);
    src.connect(filter).connect(gain).connect(this.master);
    src.start(t0);
    src.stop(t0 + dur + 0.02);
  }
  shoot() {
    this._tone({ freq: 900, dur: 0.05, type: "square", vol: 0.5 });
    setTimeout(() => this._tone({ freq: 1500, dur: 0.04, type: "square", vol: 0.4 }), 30);
  }
  explosion() {
    this._noise({ dur: 0.22, vol: 0.6, lp: 1400 });
    setTimeout(() => this._tone({ freq: 80, type: "sine", dur: 0.2, attack: 0.005, decay: 0.22, vol: 0.5 }), 10);
  }
  bossExplosion() {
    this._noise({ dur: 0.5, vol: 0.8, lp: 800 });
    setTimeout(() => this._tone({ freq: 60, type: "sine", dur: 0.4, attack: 0.01, decay: 0.4, vol: 0.7 }), 20);
  }
  popup() { this._tone({ freq: 600, dur: 0.06, type: "triangle", vol: 0.35 }); }
  correct() {
    [880, 1175, 1480].forEach((f, i) => setTimeout(() => this._tone({ freq: f, type: "sine", dur: 0.08, vol: 0.5 }), i * 90));
  }
  incorrect() {
    [300, 220, 160].forEach((f, i) => setTimeout(() => this._tone({ freq: f, type: "sawtooth", dur: 0.09, vol: 0.5 }), i * 70));
  }
  timeout() {
    [400, 350, 300, 250].forEach((f, i) => setTimeout(() => this._tone({ freq: f, type: "triangle", dur: 0.1, vol: 0.4 }), i * 100));
  }
  gameover() {
    [440, 330, 220, 150].forEach((f, i) => setTimeout(() => this._tone({ freq: f, type: "triangle", dur: 0.18, vol: 0.6 }), i * 160));
  }
  bossWarning() {
    [200, 400, 200, 400].forEach((f, i) => setTimeout(() => this._tone({ freq: f, type: "sawtooth", dur: 0.3, vol: 0.6 }), i * 300));
  }
  startBGM() {
    if (!this.enabled || this._bgmTimer) return;
    const pattern = [523, 587, 659, 523, 523, 587, 659, 698];
    let idx = 0;
    this._bgmTimer = setInterval(() => {
      this._tone({ freq: pattern[idx % pattern.length], type: "sine", dur: 0.12, vol: 0.25 });
      idx++;
    }, 320);
  }
  stopBGM() {
    if (this._bgmTimer) { clearInterval(this._bgmTimer); this._bgmTimer = null; }
  }
}
const SND = new SoundManager();

// Game variables
let player = { x: 400, y: 500, health: 100, spirit: 100 };
let enemies = [];
let bullets = [];
let enemyBullets = [];
let score = 0;
let wave = 1;
let gameRunning = true;
let questionActive = false;
let keys = {};
let lastEnemySpawn = 0;
let currentQuestionIndex = 0;
let questionTimer = null;
let questionTimeLeft = 0;
let currentDifficulty = 'easy';
let maxDifficultyReached = 'easy';
let bossActive = false;

// C·∫≠p nh·∫≠t c√¢u h·ªèi v·ªõi ng∆∞·ª°ng ƒëi·ªÉm m·ªõi v√† nhi·ªÅu c√¢u h·ªèi h∆°n
const questions = {
  easy: [
    {
      question: "Theo H·ªì Ch√≠ Minh, nh√† n∆∞·ªõc ta l√† n∆∞·ªõc g√¨?",
      answers: ["N∆∞·ªõc d√¢n ch·ªß v√¨ d√¢n", "N∆∞·ªõc phong ki·∫øn c≈©", "N∆∞·ªõc t∆∞ b·∫£n ch·ªß nghƒ©a", "N∆∞·ªõc qu√¢n ch·ªß l·∫≠p hi·∫øn"],
      correct: 0,
      explanation: "H·ªì Ch√≠ Minh kh·∫≥ng ƒë·ªãnh: 'N∆∞·ªõc ta l√† n∆∞·ªõc d√¢n ch·ªß, bao nhi√™u l·ª£i √≠ch ƒë·ªÅu v√¨ d√¢n, bao nhi√™u quy·ªÅn h·∫°n ƒë·ªÅu c·ªßa d√¢n.'",
      timeLimit: 15
    },
    {
      question: "Quy·ªÅn h√†nh v√† l·ª±c l∆∞·ª£ng ƒë·ªÅu ·ªü ƒë√¢u theo t∆∞ t∆∞·ªüng H·ªì Ch√≠ Minh?",
      answers: ["·ªû n∆°i d√¢n ch√∫ng", "·ªû n∆°i ch√≠nh ph·ªß", "·ªû n∆°i qu√¢n ƒë·ªôi", "·ªû n∆°i c√°c quan l·∫°i"],
      correct: 0,
      explanation: "B√°c H·ªì kh·∫≥ng ƒë·ªãnh: 'Quy·ªÅn h√†nh v√† l·ª±c l∆∞·ª£ng ƒë·ªÅu ·ªü n∆°i d√¢n.'",
      timeLimit: 12
    },
    {
      question: "H·ªì Ch√≠ Minh n√≥i: 'Vi·ªác g√¨ c√≥ l·ª£i cho d√¢n, ta ph·∫£i...'?",
      answers: ["H·∫øt s·ª©c l√†m ngay", "C√¢n nh·∫Øc k·ªπ l∆∞·ª°ng", "B√°o c√°o c·∫•p tr√™n", "Th·∫£o lu·∫≠n t·∫≠p th·ªÉ"],
      correct: 0,
      explanation: "'Vi·ªác g√¨ c√≥ l·ª£i cho d√¢n, ta ph·∫£i h·∫øt s·ª©c l√†m. Vi·ªác g√¨ c√≥ h·∫°i cho d√¢n, ta ph·∫£i h·∫øt s·ª©c tr√°nh.'",
      timeLimit: 12
    },
    {
      question: "Theo H·ªì Ch√≠ Minh, c√°n b·ªô l√† g√¨ c·ªßa nh√¢n d√¢n?",
      answers: ["L√† c√¥ng b·ªôc trung th√†nh", "L√† ng∆∞·ªùi l√£nh ƒë·∫°o", "L√† quan c√°ch m·∫°ng", "L√† th·∫ßy d·∫°y h·ªçc"],
      correct: 0,
      explanation: "H·ªì Ch√≠ Minh nhi·ªÅu l·∫ßn nh·∫•n m·∫°nh c√°n b·ªô, ƒë·∫£ng vi√™n ph·∫£i l√† ƒë·∫ßy t·ªõ trung th√†nh c·ªßa nh√¢n d√¢n.",
      timeLimit: 15
    },
    {
      question: "Nh√† n∆∞·ªõc do ai l·∫≠p n√™n theo t∆∞ t∆∞·ªüng H·ªì Ch√≠ Minh?",
      answers: ["Do nh√¢n d√¢n l·∫≠p n√™n", "Do ch√≠nh ph·ªß th√†nh l·∫≠p", "Do qu√¢n ƒë·ªôi x√¢y d·ª±ng", "Do c√°c ƒë·∫£ng ph√°i t·∫°o ra"],
      correct: 0,
      explanation: "Nh√† n∆∞·ªõc do nh√¢n d√¢n l·∫≠p n√™n th√¥ng qua h√¨nh th·ª©c b·∫ßu c·ª≠ t·ª± do, d√¢n ch·ªß.",
      timeLimit: 14
    },
    {
      question: "D√¢n ch·ªß l√† ƒë·ªÉ l√†m g√¨ theo H·ªì Ch√≠ Minh?",
      answers: ["ƒê·ªÉ d√¢n ƒë∆∞·ª£c n√≥i, b√†y t·ªè √Ω ki·∫øn", "ƒê·ªÉ d√¢n ƒë∆∞·ª£c nghe l·ªánh", "ƒê·ªÉ d√¢n ƒë∆∞·ª£c b·∫£o v·ªá", "ƒê·ªÉ d√¢n ƒë∆∞·ª£c h·ªçc t·∫≠p"],
      correct: 0,
      explanation: "'D√¢n ch·ªß l√† ƒë·ªÉ l√†m sao cho d√¢n ƒë∆∞·ª£c m·ªü mi·ªáng ra, ƒë∆∞·ª£c n√≥i, ƒë∆∞·ª£c b√†y t·ªè √Ω ki·∫øn c·ªßa m√¨nh.'",
      timeLimit: 16
    },
    {
      question: "Nh√¢n d√¢n c√≥ quy·ªÅn g√¨ v·ªõi nh·ªØng ƒë·∫°i bi·ªÉu kh√¥ng x·ª©ng ƒë√°ng?",
      answers: ["C√≥ quy·ªÅn b√£i mi·ªÖn", "Ch·ªâ ƒë∆∞·ª£c g√≥p √Ω", "Ph·∫£i ch·ªù h·∫øt nhi·ªám k·ª≥", "Kh√¥ng ƒë∆∞·ª£c l√†m g√¨"],
      correct: 0,
      explanation: "N·∫øu nh·ªØng ƒë·∫°i bi·ªÉu ƒë∆∞·ª£c nh√¢n d√¢n l·ª±a ch·ªçn kh√¥ng c√≤n x·ª©ng ƒë√°ng, nh√¢n d√¢n c√≥ quy·ªÅn b√£i mi·ªÖn.",
      timeLimit: 18
    },
    {
      question: "Theo H·ªì Ch√≠ Minh, nh√¢n d√¢n tham gia qu·∫£n l√Ω nh√† n∆∞·ªõc qua h√¨nh th·ª©c n√†o?",
      answers: ["B·∫ßu c·ª≠, ·ª©ng c·ª≠, ƒë√≥ng g√≥p √Ω ki·∫øn", "Ch·ªâ th√¥ng qua b·∫ßu c·ª≠", "Ch·ªâ ƒë∆∞·ª£c ƒë√≥ng g√≥p √Ω ki·∫øn", "Ch·ªâ ƒë∆∞·ª£c ·ª©ng c·ª≠"],
      correct: 0,
      explanation: "Ng∆∞·ªùi d√¢n tham gia v√†o qu·∫£n l√Ω th√¥ng qua b·∫ßu c·ª≠, ·ª©ng c·ª≠, ƒë√≥ng g√≥p √Ω ki·∫øn, ph·∫£n bi·ªán x√£ h·ªôi.",
      timeLimit: 20
    },
    {
      question: "B·∫£n ch·∫•t d√¢n ch·ªß c·ªßa nh√† n∆∞·ªõc XHCN Vi·ªát Nam th·ªÉ hi·ªán ·ªü ƒëi·ªÅu g√¨?",
      answers: ["Quy·ªÅn l·ª±c thu·ªôc v·ªÅ nh√¢n d√¢n", "Ch√≠nh ph·ªß m·∫°nh m·∫Ω", "Qu√¢n ƒë·ªôi h√πng m·∫°nh", "Kinh t·∫ø ph√°t tri·ªÉn"],
      correct: 0,
      explanation: "Th·ªÉ hi·ªán b·∫£n ch·∫•t d√¢n ch·ªß c·ªßa nh√† n∆∞·ªõc x√£ h·ªôi ch·ªß nghƒ©a Vi·ªát Nam - quy·ªÅn l·ª±c thu·ªôc v·ªÅ nh√¢n d√¢n.",
      timeLimit: 17
    },
    {
      question: "Nh√† n∆∞·ªõc ph·∫£i xu·∫•t ph√°t t·ª´ ƒëi·ªÅu g√¨ theo H·ªì Ch√≠ Minh?",
      answers: ["T·ª´ l·ª£i √≠ch nh√¢n d√¢n", "T·ª´ l·ª£i √≠ch qu·ªëc gia", "T·ª´ truy·ªÅn th·ªëng d√¢n t·ªôc", "T·ª´ xu h∆∞·ªõng th·∫ø gi·ªõi"],
      correct: 0,
      explanation: "Nh√† n∆∞·ªõc do nh√¢n d√¢n l·∫≠p n√™n, ph·ª•c v·ª• l·ª£i √≠ch nh√¢n d√¢n.",
      timeLimit: 16
    }
  ],
  medium: [
    {
      question: "Theo H·ªì Ch√≠ Minh, nh√¢n d√¢n th·ª±c hi·ªán quy·ªÅn l·ª±c nh√† n∆∞·ªõc qua h√¨nh th·ª©c n√†o?",
      answers: ["Tr·ª±c ti·∫øp ho·∫∑c gi√°n ti·∫øp qua QH, HƒêND", "Ch·ªâ th√¥ng qua b·∫ßu c·ª≠", "Ch·ªâ th√¥ng qua ƒë·∫°i bi·ªÉu", "Ch·ªâ th√¥ng qua M·∫∑t tr·∫≠n"],
      correct: 0,
      explanation: "Nh√¢n d√¢n tr·ª±c ti·∫øp ho·∫∑c gi√°n ti·∫øp th√¥ng qua Qu·ªëc h·ªôi, H·ªôi ƒë·ªìng nh√¢n d√¢n th·ª±c hi·ªán quy·ªÅn l·ª±c nh√† n∆∞·ªõc.",
      timeLimit: 20
    },
    {
      question: "H·ªì Ch√≠ Minh coi vi·ªác x√¢y d·ª±ng Nh√† n∆∞·ªõc trong s·∫°ch, v·ªØng m·∫°nh l√† g√¨?",
      answers: ["Y·∫øu t·ªë s·ªëng c√≤n c·ªßa ch·∫ø ƒë·ªô", "Nhi·ªám v·ª• quan tr·ªçng", "M·ª•c ti√™u l√¢u d√†i", "∆Ø·ªõc m∆° cao ƒë·∫πp"],
      correct: 0,
           explanation: "H·ªì Ch√≠ Minh lu√¥n coi vi·ªác x√¢y d·ª±ng m·ªôt Nh√† n∆∞·ªõc trong s·∫°ch, v·ªØng m·∫°nh l√† y·∫øu t·ªë s·ªëng c√≤n c·ªßa ch·∫ø ƒë·ªô.",
      timeLimit: 22
    },
    {
      question: "Trong s·∫°ch c√≥ nghƒ©a l√† kh√¥ng c√≥ nh·ªØng g√¨ theo H·ªì Ch√≠ Minh?",
      answers: ["Kh√¥ng tham nh≈©ng, ƒë·∫∑c quy·ªÅn, xa d√¢n", "Ch·ªâ kh√¥ng tham nh≈©ng", "Ch·ªâ kh√¥ng c√≥ ƒë·∫∑c quy·ªÅn", "Ch·ªâ kh√¥ng xa r·ªùi nh√¢n d√¢n"],
      correct: 0,
      explanation: "Trong s·∫°ch c√≥ nghƒ©a l√† kh√¥ng tham nh≈©ng, kh√¥ng ƒë·∫∑c quy·ªÅn ƒë·∫∑c l·ª£i, kh√¥ng xa r·ªùi nh√¢n d√¢n.",
      timeLimit: 25
    },
    {
      question: "Theo H·ªì Ch√≠ Minh, quy·ªÅn l·ª±c nh√† n∆∞·ªõc ph·∫£i ƒë∆∞·ª£c nh∆∞ th·∫ø n√†o?",
      answers: ["Ph√¢n c√¥ng, ph·ªëi h·ª£p v√† ki·ªÉm so√°t", "T·∫≠p trung tuy·ªát ƒë·ªëi", "Ph√¢n t√°n ho√†n to√†n", "ƒê·ªÉ t·ª± nhi√™n v·∫≠n h√†nh"],
      correct: 0,
      explanation: "Quy·ªÅn l·ª±c ph·∫£i ƒë∆∞·ª£c ph√¢n c√¥ng, ph·ªëi h·ª£p v√† ki·ªÉm so√°t ch·∫∑t ch·∫Ω.",
      timeLimit: 22
    },
    {
      question: "H·ªì Ch√≠ Minh y√™u c·∫ßu c√°n b·ªô ph·∫£i c√≥ ph·∫©m ch·∫•t g√¨?",
      answers: ["C·∫ßn, ki·ªám, li√™m, ch√≠nh", "Th√¥ng minh, kh√©o l√©o", "M·∫°nh m·∫Ω, quy·∫øt ƒëo√°n", "Gi√†u c√≥, c√≥ th·∫ø l·ª±c"],
      correct: 0,
      explanation: "M·ªçi c√°n b·ªô, ƒë·∫£ng vi√™n ph·∫£i c·∫ßn, ki·ªám, li√™m, ch√≠nh, ch√≠ c√¥ng v√¥ t∆∞.",
      timeLimit: 18
    },
    {
      question: "H·ªì Ch√≠ Minh v√≠ tham nh≈©ng, quan li√™u nh∆∞ g√¨?",
      answers: ["Nh∆∞ gi·∫∑c n·ªôi x√¢m", "Nh∆∞ b·ªánh nan y", "Nh∆∞ th·∫£m h·ªça thi√™n nhi√™n", "Nh∆∞ k·∫ª th√π ngo·∫°i bang"],
      correct: 0,
      explanation: "Ng∆∞·ªùi v√≠ tham nh≈©ng, quan li√™u nh∆∞ 'gi·∫∑c n·ªôi x√¢m', nguy hi·ªÉm kh√¥ng k√©m gi·∫∑c ngo·∫°i x√¢m.",
      timeLimit: 20
    },
    {
      question: "Theo H·ªì Ch√≠ Minh, b·ªô m√°y nh√† n∆∞·ªõc ph·∫£i nh∆∞ th·∫ø n√†o?",
      answers: ["G·ªçn nh·∫π, hi·ªáu qu·∫£, g·∫ßn d√¢n", "To l·ªõn, uy quy·ªÅn", "Ph·ª©c t·∫°p, ch·∫∑t ch·∫Ω", "ƒê∆°n gi·∫£n, th·ª• ƒë·ªông"],
      correct: 0,
      explanation: "X√¢y d·ª±ng b·ªô m√°y g·ªçn nh·∫π, hi·ªáu qu·∫£, g·∫ßn g≈©i v·ªõi nh√¢n d√¢n.",
      timeLimit: 24
    },
    {
      question: "H·ªì Ch√≠ Minh n√≥i: 'C√°n b·ªô l√† g·ªëc c·ªßa...'?",
      answers: ["M·ªçi c√¥ng vi·ªác", "S·ª± th√†nh c√¥ng", "C√°ch m·∫°ng", "ƒê·∫•t n∆∞·ªõc"],
      correct: 0,
      explanation: "C√°n b·ªô l√† g·ªëc c·ªßa m·ªçi c√¥ng vi·ªác - nh·∫•n m·∫°nh vai tr√≤ quan tr·ªçng c·ªßa ƒë·ªôi ng≈© c√°n b·ªô.",
      timeLimit: 16
    },
    {
      question: "Theo H·ªì Ch√≠ Minh, ch·ªçn c√°n b·ªô ph·∫£i ch·ªçn ng∆∞·ªùi nh∆∞ th·∫ø n√†o?",
      answers: ["C√≥ ƒë·ª©c, c√≥ t√†i", "Ch·ªâ c√≥ t√†i nƒÉng", "Ch·ªâ c√≥ ƒë·∫°o ƒë·ª©c", "C√≥ quan h·ªá t·ªët"],
      correct: 0,
      explanation: "H·ªì Ch√≠ Minh y√™u c·∫ßu ch·ªçn ng∆∞·ªùi c√≥ ƒë·ª©c, c√≥ t√†i, v·ª´a 'h·ªìng' v·ª´a 'chuy√™n'.",
      timeLimit: 19
    },
    {
      question: "Nh√† n∆∞·ªõc ph√°p quy·ªÅn XHCN l√† nh√† n∆∞·ªõc qu·∫£n l√Ω x√£ h·ªôi b·∫±ng g√¨?",
      answers: ["B·∫±ng ph√°p lu·∫≠t", "B·∫±ng quy·ªÅn l·ª±c", "B·∫±ng truy·ªÅn th·ªëng", "B·∫±ng kinh nghi·ªám"],
      correct: 0,
      explanation: "Nh√† n∆∞·ªõc ph√°p quy·ªÅn XHCN l√† nh√† n∆∞·ªõc qu·∫£n l√Ω x√£ h·ªôi b·∫±ng ph√°p lu·∫≠t, b·∫£o ƒë·∫£m quy·ªÅn l·ª±c thu·ªôc v·ªÅ nh√¢n d√¢n.",
      timeLimit: 23
    }
  ],
  hard: [
    {
      question: "H·ªì Ch√≠ Minh kh·∫≥ng ƒë·ªãnh b·∫£n ch·∫•t c·ªßa nh√† n∆∞·ªõc d√¢n ch·ªß l√† 'bao nhi√™u l·ª£i √≠ch ƒë·ªÅu v√¨ d√¢n, bao nhi√™u quy·ªÅn h·∫°n ƒë·ªÅu c·ªßa d√¢n'. ƒêi·ªÅu n√†y th·ªÉ hi·ªán nguy√™n t·∫Øc n√†o?",
      answers: ["D√¢n l√† ch·ªß th·ªÉ t·ªëi cao quy·ªÅn l·ª±c", "Nh√† n∆∞·ªõc l√† trung t√¢m quy·ªÅn l·ª±c", "ƒê·∫£ng l√£nh ƒë·∫°o tuy·ªát ƒë·ªëi", "Ch√≠nh ph·ªß ƒëi·ªÅu h√†nh m·ªçi vi·ªác"],
      correct: 0,
      explanation: "Th·ªÉ hi·ªán s√¢u s·∫Øc quan ƒëi·ªÉm d√¢n l√† ch·ªß, d√¢n l√† ch·ªß th·ªÉ t·ªëi cao c·ªßa quy·ªÅn l·ª±c nh√† n∆∞·ªõc.",
      timeLimit: 30
    },
    {
      question: "Theo H·ªì Ch√≠ Minh, ngu·ªìn g·ªëc quy·ªÅn l·ª±c nh√† n∆∞·ªõc t·ª´ ƒë√¢u m√† ra?",
      answers: ["T·ª´ nh√¢n d√¢n m√† ra", "T·ª´ hi·∫øn ph√°p quy ƒë·ªãnh", "T·ª´ truy·ªÅn th·ªëng l·ªãch s·ª≠", "T·ª´ s·ª± ·ªßy quy·ªÅn qu·ªëc t·∫ø"],
      correct: 0,
      explanation: "Kh·∫≥ng ƒë·ªãnh ngu·ªìn g·ªëc quy·ªÅn l·ª±c nh√† n∆∞·ªõc l√† t·ª´ nh√¢n d√¢n m√† ra.",
      timeLimit: 28
    },
    {
      question: "H·ªì Ch√≠ Minh nh·∫•n m·∫°nh ph√≤ng ch·ªëng tham nh≈©ng c√≥ √Ω nghƒ©a g√¨ ƒë·ªëi v·ªõi ch·∫ø ƒë·ªô?",
      answers: ["C·ªßng c·ªë ni·ªÅm tin d√¢n v·ªõi ƒê·∫£ng, Nh√† n∆∞·ªõc", "Ch·ªâ ƒë·ªÉ tr·ª´ng ph·∫°t k·∫ª x·∫•u", "T·∫°o s·ª± s·ª£ h√£i trong c√°n b·ªô", "Th·ªÉ hi·ªán quy·ªÅn l·ª±c ph√°p lu·∫≠t"],
      correct: 0,
      explanation: "Ph√≤ng, ch·ªëng tham nh≈©ng g√≥p ph·∫ßn c·ªßng c·ªë ni·ªÅm tin c·ªßa nh√¢n d√¢n v√†o ƒê·∫£ng v√† Nh√† n∆∞·ªõc.",
      timeLimit: 32
    },
    {
      question: "H·ªì Ch√≠ Minh nh·∫•n m·∫°nh 'ki·ªÉm so√°t quy·ªÅn l·ª±c nh√† n∆∞·ªõc' nh·∫±m ngƒÉn ch·∫∑n nguy c∆° n√†o?",
      answers: ["NgƒÉn ch·∫∑n l·∫°m quy·ªÅn v√† l·ª£i √≠ch nh√≥m", "NgƒÉn ch·∫∑n s·ª± y·∫øu k√©m", "NgƒÉn ch·∫∑n thi·∫øu ƒëo√†n k·∫øt", "NgƒÉn ch·∫∑n m·∫•t k·ª∑ lu·∫≠t"],
      correct: 0,
      explanation: "Quy·ªÅn l·ª±c ph·∫£i ƒë∆∞·ª£c ki·ªÉm so√°t ch·∫∑t ch·∫Ω ƒë·ªÉ ngƒÉn ch·∫∑n t√¨nh tr·∫°ng l·∫°m quy·ªÅn, l·ª£i √≠ch nh√≥m.",
      timeLimit: 35
    },
    {
      question: "Theo H·ªì Ch√≠ Minh, t·ª± ph√™ b√¨nh v√† ph√™ b√¨nh l√† g√¨ c·ªßa ƒê·∫£ng?",
      answers: ["V≈© kh√≠ s·∫Øc b√©n x√¢y d·ª±ng ƒê·∫£ng", "Ph∆∞∆°ng ph√°p h·ªçc t·∫≠p", "H√¨nh th·ª©c k·ª∑ lu·∫≠t", "C√°ch th·ª©c ƒëo√†n k·∫øt"],
      correct: 0,
      explanation: "H·ªì Ch√≠ Minh coi t·ª± ph√™ b√¨nh v√† ph√™ b√¨nh l√† 'v≈© kh√≠ s·∫Øc b√©n' ƒë·ªÉ x√¢y d·ª±ng ƒê·∫£ng.",
      timeLimit: 27
    },
    {
      question: "H·ªì Ch√≠ Minh c·∫£nh b√°o ch·ªß nghƒ©a c√° nh√¢n l√† g√¨?",
      answers: ["Gi·∫∑c n·ªôi x√¢m", "T·ªá n·∫°n x√£ h·ªôi", "Sai l·∫ßm t∆∞ t∆∞·ªüng", "Khuy·∫øt ƒëi·ªÉm c√° nh√¢n"],
      correct: 0,
      explanation: "Ch·ªß nghƒ©a c√° nh√¢n l√† 'gi·∫∑c n·ªôi x√¢m', l√† nguy√™n nh√¢n c·ªßa tham nh≈©ng, quan li√™u.",
      timeLimit: 25
    },
    {
      question: "Theo H·ªì Ch√≠ Minh, ph√°p lu·∫≠t ph·∫£i ph·∫£n √°nh ƒëi·ªÅu g√¨?",
      answers: ["√ù ch√≠, l·ª£i √≠ch c·ªßa nh√¢n d√¢n", "Ch·ªß tr∆∞∆°ng c·ªßa ƒê·∫£ng", "Y√™u c·∫ßu c·ªßa th·ªùi ƒë·∫°i", "Kinh nghi·ªám qu·ªëc t·∫ø"],
      correct: 0,
      explanation: "Ph√°p lu·∫≠t ph·∫£i ph·∫£n √°nh √Ω ch√≠, l·ª£i √≠ch c·ªßa nh√¢n d√¢n.",
      timeLimit: 26
    },
    {
      question: "C·∫£i c√°ch h√†nh ch√≠nh c·∫ßn ƒë·∫°t m·ª•c ti√™u g√¨ theo t∆∞ t∆∞·ªüng H·ªì Ch√≠ Minh?",
      answers: ["B·ªô m√°y tinh g·ªçn, hi·ªáu qu·∫£", "TƒÉng quy·ªÅn l·ª±c c∆° quan", "Gi·∫£m chi ph√≠ ng√¢n s√°ch", "TƒÉng t·ªëc ƒë·ªô x·ª≠ l√Ω"],
      correct: 0,
      explanation: "B·ªô m√°y nh√† n∆∞·ªõc ph·∫£i tinh g·ªçn, ho·∫°t ƒë·ªông hi·ªáu l·ª±c, hi·ªáu qu·∫£, ph·ª•c v·ª• nh√¢n d√¢n t·ªët nh·∫•t.",
      timeLimit: 29
    },
    {
      question: "Theo H·ªì Ch√≠ Minh, nh√† n∆∞·ªõc ph·∫£i t√¥n tr·ªçng v√† b·∫£o ƒë·∫£m ƒëi·ªÅu g√¨?",
      answers: ["Quy·ªÅn con ng∆∞·ªùi, quy·ªÅn c√¥ng d√¢n", "Quy·ªÅn l·ª±c nh√† n∆∞·ªõc", "Quy·ªÅn c·ªßa c√°n b·ªô", "Quy·ªÅn c·ªßa t·∫≠p th·ªÉ"],
      correct: 0,
      explanation: "Nh√† n∆∞·ªõc ph·∫£i t√¥n tr·ªçng, b·∫£o v·ªá v√† b·∫£o ƒë·∫£m quy·ªÅn con ng∆∞·ªùi, quy·ªÅn c√¥ng d√¢n.",
      timeLimit: 28
    },
    {
      question: "H·ªì Ch√≠ Minh n√≥i: 'N·∫øu ƒë·ªÉ h·ªèng c√°n b·ªô th√¨ s·∫Ω...'?",
      answers: ["L√†m h·ªèng c√¥ng vi·ªác v√† c·∫£ ch·∫ø ƒë·ªô", "M·∫•t uy t√≠n v·ªõi d√¢n", "Kh√¥ng ho√†n th√†nh nhi·ªám v·ª•", "G√¢y thi·ªát h·∫°i kinh t·∫ø"],
      correct: 0,
      explanation: "'C√°n b·ªô l√† c√¥ng b·ªôc c·ªßa d√¢n. N·∫øu ƒë·ªÉ h·ªèng c√°n b·ªô th√¨ s·∫Ω l√†m h·ªèng c√¥ng vi·ªác v√† h·ªèng c·∫£ ch·∫ø ƒë·ªô.'",
      timeLimit: 31
    }
  ],
  expert: [
    {
      question: "H·ªì Ch√≠ Minh n√≥i: 'M·ªôt d√¢n t·ªôc, m·ªôt ƒê·∫£ng... kh√¥ng nh·∫•t ƒë·ªãnh h√¥m nay v√† ng√†y mai v·∫´n ƒë∆∞·ª£c m·ªçi ng∆∞·ªùi y√™u m·∫øn n·∫øu...' ƒëi·ªÅu g√¨?",
      answers: ["Sa v√†o ch·ªß nghƒ©a c√° nh√¢n", "Thi·∫øu nƒÉng l·ª±c l√£nh ƒë·∫°o", "Kh√¥ng theo k·ªãp th·ªùi ƒë·∫°i", "M·∫•t ƒëi s·ª©c m·∫°nh qu√¢n s·ª±"],
      correct: 0,
      explanation: "'...n·∫øu l√≤ng d·∫° kh√¥ng trong s√°ng n·ªØa, n·∫øu sa v√†o ch·ªß nghƒ©a c√° nh√¢n' - c·∫£nh b√°o v·ªÅ nguy c∆° t·ª´ b√™n trong.",
      timeLimit: 40
    },
    {
      question: "Theo H·ªì Ch√≠ Minh, √Ω nghƒ©a s√¢u xa c·ªßa vi·ªác 'tƒÉng c∆∞·ªùng s·ª± gi√°m s√°t c·ªßa nh√¢n d√¢n, M·∫∑t tr·∫≠n v√† b√°o ch√≠' l√† g√¨?",
      answers: ["Th·ªÉ hi·ªán b·∫£n ch·∫•t d√¢n ch·ªß th·ª±c s·ª±", "TƒÉng c∆∞·ªùng ki·ªÉm tra k·ª∑ lu·∫≠t", "Ph√°t hi·ªán sai ph·∫°m k·ªãp th·ªùi", "T·∫°o √°p l·ª±c v·ªõi c√°n b·ªô"],
      correct: 0,
      explanation: "Th·ªÉ hi·ªán b·∫£n ch·∫•t d√¢n ch·ªß th·ª±c s·ª± c·ªßa ch·∫ø ƒë·ªô, ƒë·∫£m b·∫£o quy·ªÅn l√†m ch·ªß c·ªßa nh√¢n d√¢n.",
      timeLimit: 42
    },
    {
      question: "H·ªì Ch√≠ Minh coi ƒê·∫£ng v·ª´a l√† ng∆∞·ªùi l√£nh ƒë·∫°o, v·ª´a l√† g√¨ v·ªõi ƒë·∫∑c ƒëi·ªÉm g√¨ v·ªÅ m·ªëi quan h·ªá v·ªõi nh√¢n d√¢n?",
      answers: ["Ng∆∞·ªùi ƒë·∫ßy t·ªõ trung th√†nh c·ªßa d√¢n", "Ng∆∞·ªùi gi√°m s√°t x√£ h·ªôi", "Ng∆∞·ªùi ra quy·∫øt ƒë·ªãnh cu·ªëi c√πng", "Ng∆∞·ªùi ƒëi·ªÅu h√†nh b·ªô m√°y"],
      correct: 0,
      explanation: "H·ªì Ch√≠ Minh coi ƒê·∫£ng l√† 'ng∆∞·ªùi l√£nh ƒë·∫°o, ƒë·ªìng th·ªùi l√† ng∆∞·ªùi ƒë·∫ßy t·ªõ trung th√†nh c·ªßa nh√¢n d√¢n'.",
      timeLimit: 38
    },
    {
      question: "Trong t∆∞ t∆∞·ªüng H·ªì Ch√≠ Minh v·ªÅ x√¢y d·ª±ng ƒê·∫£ng, nguy√™n t·∫Øc 't·∫≠p trung d√¢n ch·ªß' k·∫øt h·ª£p v·ªõi nh·ªØng nguy√™n t·∫Øc n√†o ƒë·ªÉ ƒë·∫£m b·∫£o hi·ªáu qu·∫£ l√£nh ƒë·∫°o?",
      answers: ["T·ª± ph√™ b√¨nh v√† g·∫ßn d√¢n, hi·ªÉu d√¢n", "Ch·ªâ t·ª± ph√™ b√¨nh v√† ph√™ b√¨nh", "Ch·ªâ g·∫ßn d√¢n, hi·ªÉu d√¢n, h·ªçc d√¢n", "K·ª∑ lu·∫≠t v√† ƒëo√†n k·∫øt"],
      correct: 0,
      explanation: "T∆∞ t∆∞·ªüng x√¢y d·ª±ng ƒê·∫£ng bao g·ªìm t·∫≠p trung d√¢n ch·ªß, t·ª± ph√™ b√¨nh v√† ph√™ b√¨nh, g·∫ßn d√¢n, hi·ªÉu d√¢n, h·ªçc d√¢n.",
      timeLimit: 45
    },
    {
      question: "Theo H·ªì Ch√≠ Minh, vi·ªác 'x√¢y d·ª±ng ƒë·ªôi ng≈© c√°n b·ªô tr·∫ª, t·∫°o ngu·ªìn k·∫ø c·∫≠n v·ªØng v√†ng' th·ªÉ hi·ªán t∆∞ t∆∞·ªüng g√¨?",
      answers: ["Ph√°t tri·ªÉn b·ªÅn v·ªØng, l√¢u d√†i", "Thay ƒë·ªïi th·∫ø h·ªá l√£nh ƒë·∫°o", "ƒê·ªïi m·ªõi t∆∞ duy qu·∫£n l√Ω", "TƒÉng c∆∞·ªùng s·ª©c tr·∫ª"],
      correct: 0,
      explanation: "Th·ªÉ hi·ªán t·∫ßm nh√¨n ph√°t tri·ªÉn b·ªÅn v·ªØng, ƒë·∫£m b·∫£o s·ª± k·∫ø th·ª´a v√† ph√°t tri·ªÉn l√¢u d√†i c·ªßa c√°ch m·∫°ng.",
      timeLimit: 40
    },
    {
      question: "H·ªì Ch√≠ Minh nh·∫•n m·∫°nh 'c·∫£i c√°ch h√†nh ch√≠nh' c·∫ßn ƒë·∫°t ƒë∆∞·ª£c m·ª•c ti√™u n√†o quan tr·ªçng nh·∫•t?",
      answers: ["B·ªô m√°y tinh g·ªçn, hi·ªáu qu·∫£ ph·ª•c v·ª• d√¢n", "TƒÉng quy·ªÅn l·ª±c cho c∆° quan nh√† n∆∞·ªõc", "Gi·∫£m chi ph√≠ ng√¢n s√°ch", "TƒÉng t·ªëc ƒë·ªô x·ª≠ l√Ω c√¥ng vi·ªác"],
      correct: 0,
      explanation: "B·ªô m√°y nh√† n∆∞·ªõc ph·∫£i tinh g·ªçn, ho·∫°t ƒë·ªông hi·ªáu l·ª±c, hi·ªáu qu·∫£, ph·ª•c v·ª• nh√¢n d√¢n t·ªët nh·∫•t.",
      timeLimit: 43
    },
    {
      question: "Trong t∆∞ t∆∞·ªüng H·ªì Ch√≠ Minh v·ªÅ nh√† n∆∞·ªõc 'c·ªßa d√¢n, do d√¢n, v√¨ d√¢n', y·∫øu t·ªë n√†o ƒë∆∞·ª£c coi l√† c·ªët l√µi nh·∫•t?",
      answers: ["Nh√¢n d√¢n l√† ngu·ªìn g·ªëc m·ªçi quy·ªÅn l·ª±c", "Nh√† n∆∞·ªõc ph·ª•c v·ª• nh√¢n d√¢n", "Nh√¢n d√¢n gi√°m s√°t nh√† n∆∞·ªõc", "Nh√† n∆∞·ªõc b·∫£o v·ªá nh√¢n d√¢n"],
      correct: 0,
      explanation: "C·ªët l√µi l√† kh·∫≥ng ƒë·ªãnh nh√¢n d√¢n l√† ngu·ªìn g·ªëc, ch·ªß th·ªÉ c·ªßa m·ªçi quy·ªÅn l·ª±c nh√† n∆∞·ªõc.",
      timeLimit: 41
    },
    {
      question: "Theo H·ªì Ch√≠ Minh, vi·ªác 'ƒë∆°n gi·∫£n h√≥a th·ªß t·ª•c h√†nh ch√≠nh, ch·ªëng quan li√™u, c·ª≠a quy·ªÅn' nh·∫±m m·ª•c ƒë√≠ch g√¨?",
      answers: ["N√¢ng cao ch·∫•t l∆∞·ª£ng ph·ª•c v·ª• d√¢n", "Gi·∫£m kh·ªëi l∆∞·ª£ng c√¥ng vi·ªác", "TƒÉng hi·ªáu qu·∫£ l√†m vi·ªác", "Ti·∫øt ki·ªám th·ªùi gian"],
      correct: 0,
      explanation: "ƒê∆°n gi·∫£n h√≥a th·ªß t·ª•c h√†nh ch√≠nh, ch·ªëng quan li√™u, c·ª≠a quy·ªÅn ƒë·ªÉ n√¢ng cao ch·∫•t l∆∞·ª£ng ph·ª•c v·ª• nh√¢n d√¢n.",
      timeLimit: 39
    },
    {
      question: "H·ªì Ch√≠ Minh coi vi·ªác 'khuy·∫øn kh√≠ch v√† b·∫£o v·ªá ng∆∞·ªùi t·ªë c√°o tham nh≈©ng' l√† bi·ªán ph√°p g√¨ trong ƒë·∫•u tranh ch·ªëng tham nh≈©ng?",
      answers: ["Ph√°t huy d√¢n ch·ªß, gi√°m s√°t nh√¢n d√¢n", "TƒÉng c∆∞·ªùng ph√°p lu·∫≠t", "RƒÉn ƒëe c√°n b·ªô", "T·∫°o s·ª©c √©p x√£ h·ªôi"],
      correct: 0,
      explanation: "Khuy·∫øn kh√≠ch v√† b·∫£o v·ªá ng∆∞·ªùi t·ªë c√°o tham nh≈©ng l√† c√°ch ph√°t huy vai tr√≤ gi√°m s√°t c·ªßa nh√¢n d√¢n.",
      timeLimit: 44
    },
    {
      question: "Trong quan ƒëi·ªÉm H·ªì Ch√≠ Minh, 't·∫°o ƒëi·ªÅu ki·ªán ƒë·ªÉ m·ªçi ng∆∞·ªùi d√¢n ƒë∆∞·ª£c s·ªëng t·ª± do, b√¨nh ƒë·∫≥ng v√† h·∫°nh ph√∫c' th·ªÉ hi·ªán b·∫£n ch·∫•t g√¨ c·ªßa nh√† n∆∞·ªõc?",
      answers: ["Nh√† n∆∞·ªõc v√¨ d√¢n, ph·ª•c v·ª• d√¢n", "Nh√† n∆∞·ªõc b·∫£o v·ªá tr·∫≠t t·ª±", "Nh√† n∆∞·ªõc qu·∫£n l√Ω x√£ h·ªôi", "Nh√† n∆∞·ªõc th·ª±c thi ph√°p lu·∫≠t"],
      correct: 0,
      explanation: "Th·ªÉ hi·ªán b·∫£n ch·∫•t nh√† n∆∞·ªõc v√¨ d√¢n, ph·ª•c v·ª• nh√¢n d√¢n, t·∫°o ƒëi·ªÅu ki·ªán cho d√¢n ƒë∆∞·ª£c h·∫°nh ph√∫c.",
      timeLimit: 42
    }
  ],
  nightmare: [
    {
      question: "H·ªì Ch√≠ Minh c·∫£nh b√°o: 'M·ªôt d√¢n t·ªôc, m·ªôt ƒê·∫£ng... ng√†y h√¥m qua l√† vƒ© ƒë·∫°i... kh√¥ng nh·∫•t ƒë·ªãnh h√¥m nay v√† ng√†y mai v·∫´n ƒë∆∞·ª£c y√™u m·∫øn n·∫øu l√≤ng d·∫° kh√¥ng trong s√°ng, sa v√†o ch·ªß nghƒ©a c√° nh√¢n'. ƒêi·ªÅu n√†y th·ªÉ hi·ªán t∆∞ t∆∞·ªüng g√¨ s√¢u s·∫Øc nh·∫•t?",
      answers: ["Nguy c∆° suy tho√°i t·ª´ b√™n trong", "T·∫ßm quan tr·ªçng c·ªßa ƒëo√†n k·∫øt", "S·ª± thay ƒë·ªïi c·ªßa l·ªãch s·ª≠", "Vai tr√≤ c·ªßa nh√¢n d√¢n"],
      correct: 0,
      explanation: "Th·ªÉ hi·ªán t∆∞ t∆∞·ªüng s√¢u s·∫Øc v·ªÅ nguy c∆° suy tho√°i, s·ª•p ƒë·ªï t·ª´ b√™n trong do ch·ªß nghƒ©a c√° nh√¢n.",
      timeLimit: 50
    },
    {
      question: "Theo H·ªì Ch√≠ Minh, vi·ªác 'ph·∫£i ti·∫øn h√†nh t·ª± ph√™ b√¨nh v√† ph√™ b√¨nh nghi√™m t√∫c, ch√¢n th√†nh, c·∫ßu th·ªã, tr√°nh h√¨nh th·ª©c' nh·∫±m ƒë·∫°t ƒë∆∞·ª£c m·ª•c ti√™u chi·∫øn l∆∞·ª£c n√†o?",
      answers: ["C·∫£ t·∫≠p th·ªÉ v√† c√° nh√¢n t·ª± soi, t·ª± s·ª≠a", "TƒÉng c∆∞·ªùng k·ª∑ lu·∫≠t t·ªï ch·ª©c", "Ph√°t hi·ªán v√† x·ª≠ l√Ω sai ph·∫°m", "Th·ªëng nh·∫•t t∆∞ t∆∞·ªüng trong ƒê·∫£ng"],
      correct: 0,
      explanation: "M·ª•c ti√™u chi·∫øn l∆∞·ª£c l√† ƒë·ªÉ c·∫£ t·∫≠p th·ªÉ v√† c√° nh√¢n ƒë·ªÅu ph·∫£i t·ª± soi, t·ª± s·ª≠a ƒë·ªÉ ho√†n thi·ªán.",
      timeLimit: 48
    },
    {
      question: "H·ªì Ch√≠ Minh kh·∫≥ng ƒë·ªãnh 'ph√°p lu·∫≠t ph·∫£i c√¥ng b·∫±ng, minh b·∫°ch, d·ªÖ hi·ªÉu, d·ªÖ th·ª±c hi·ªán' v√† 'x√¢y d·ª±ng ph√°p lu·∫≠t ƒë·ªìng b·ªô, ·ªïn ƒë·ªãnh, kh·∫£ thi'. ƒê√¢y l√† y√™u c·∫ßu c·ªët l√µi ƒë·ªÉ x√¢y d·ª±ng lo·∫°i nh√† n∆∞·ªõc n√†o?",
      answers: ["Nh√† n∆∞·ªõc ph√°p quy·ªÅn XHCN", "Nh√† n∆∞·ªõc d√¢n ch·ªß", "Nh√† n∆∞·ªõc trong s·∫°ch", "Nh√† n∆∞·ªõc v·ªØng m·∫°nh"],
      correct: 0,
      explanation: "ƒê√¢y l√† y√™u c·∫ßu c·ªët l√µi ƒë·ªÉ x√¢y d·ª±ng nh√† n∆∞·ªõc ph√°p quy·ªÅn x√£ h·ªôi ch·ªß nghƒ©a.",
      timeLimit: 52
    },
    {
      question: "Trong t∆∞ t∆∞·ªüng H·ªì Ch√≠ Minh, vi·ªác 'x·ª≠ l√Ω nghi√™m minh m·ªçi h√†nh vi tham nh≈©ng, kh√¥ng c√≥ v√πng c·∫•m' k·∫øt h·ª£p v·ªõi 'x√¢y d·ª±ng ƒë·ªôi ng≈© c√°n b·ªô li√™m ch√≠nh, c√¥ng khai t√†i s·∫£n' th·ªÉ hi·ªán ph∆∞∆°ng ch√¢m n√†o?",
      answers: ["V·ª´a ph√≤ng ng·ª´a, v·ª´a ƒë·∫•u tranh quy·∫øt li·ªát", "Ch·ªâ t·∫≠p trung v√†o tr·ª´ng ph·∫°t", "Ch·ªâ t·∫≠p trung v√†o gi√°o d·ª•c", "D·ª±a v√†o √Ω th·ª©c t·ª± gi√°c"],
      correct: 0,
      explanation: "Th·ªÉ hi·ªán ph∆∞∆°ng ch√¢m to√†n di·ªán: v·ª´a ph√≤ng ng·ª´a t·ª´ g·ªëc, v·ª´a ƒë·∫•u tranh tr·ª´ng tr·ªã quy·∫øt li·ªát.",
      timeLimit: 55
    },
    {
      question: "H·ªì Ch√≠ Minh nh·∫•n m·∫°nh 'ch·ªëng suy tho√°i v·ªÅ t∆∞ t∆∞·ªüng ch√≠nh tr·ªã, ƒë·∫°o ƒë·ª©c, l·ªëi s·ªëng trong c√°n b·ªô, ƒë·∫£ng vi√™n' v√† 'ƒë·ªïi m·ªõi ph∆∞∆°ng th·ª©c l√£nh ƒë·∫°o c·ªßa ƒê·∫£ng, g·∫Øn b√≥ m·∫≠t thi·∫øt v·ªõi nh√¢n d√¢n'. ƒê√¢y l√† y√™u c·∫ßu ƒë·ªÉ ƒë·∫°t ƒë∆∞·ª£c m·ª•c ti√™u g√¨?",
      answers: ["N√¢ng cao nƒÉng l·ª±c l√£nh ƒë·∫°o c·ªßa ƒê·∫£ng", "TƒÉng c∆∞·ªùng k·ª∑ lu·∫≠t ƒê·∫£ng", "M·ªü r·ªông t·ªï ch·ª©c ƒê·∫£ng", "Ph√°t tri·ªÉn ƒë·∫£ng vi√™n m·ªõi"],
      correct: 0,
      explanation: "ƒê√¢y l√† y√™u c·∫ßu c·ªët l√µi ƒë·ªÉ n√¢ng cao nƒÉng l·ª±c l√£nh ƒë·∫°o, s·ª©c chi·∫øn ƒë·∫•u c·ªßa ƒê·∫£ng.",
      timeLimit: 50
    },
    {
      question: "Theo H·ªì Ch√≠ Minh, 'ph√≤ng, ch·ªëng tham nh≈©ng g√≥p ph·∫ßn c·ªßng c·ªë ni·ªÅm tin c·ªßa nh√¢n d√¢n v√†o ƒê·∫£ng v√† Nh√† n∆∞·ªõc' v√† 't·∫°o m√¥i tr∆∞·ªùng x√£ h·ªôi c√¥ng b·∫±ng, minh b·∫°ch'. ƒêi·ªÅu n√†y th·ªÉ hi·ªán m·ªëi quan h·ªá bi·ªán ch·ª©ng n√†o?",
      answers: ["Gi·ªØa trong s·∫°ch v√† ni·ªÅm tin nh√¢n d√¢n", "Gi·ªØa ph√°p lu·∫≠t v√† ƒë·∫°o ƒë·ª©c", "Gi·ªØa k·ª∑ lu·∫≠t v√† t·ª± do", "Gi·ªØa c√° nh√¢n v√† t·∫≠p th·ªÉ"],
      correct: 0,
      explanation: "Th·ªÉ hi·ªán m·ªëi quan h·ªá bi·ªán ch·ª©ng gi·ªØa vi·ªác x√¢y d·ª±ng ƒê·∫£ng, Nh√† n∆∞·ªõc trong s·∫°ch v√† ni·ªÅm tin c·ªßa nh√¢n d√¢n.",
      timeLimit: 53
    },
    {
      question: "H·ªì Ch√≠ Minh coi 'gi·ªØ v·ªØng b·∫£n ch·∫•t c√°ch m·∫°ng, ki√™n ƒë·ªãnh m·ª•c ti√™u ƒë·ªôc l·∫≠p d√¢n t·ªôc v√† ch·ªß nghƒ©a x√£ h·ªôi' l√† n·ªÅn t·∫£ng ƒë·ªÉ th·ª±c hi·ªán nhi·ªám v·ª• n√†o quan tr·ªçng nh·∫•t?",
      answers: ["X√¢y d·ª±ng ƒê·∫£ng th·∫≠t s·ª± trong s·∫°ch, v·ªØng m·∫°nh", "Ph√°t tri·ªÉn kinh t·∫ø ƒë·∫•t n∆∞·ªõc", "B·∫£o v·ªá an ninh qu·ªëc gia", "N√¢ng cao ƒë·ªùi s·ªëng nh√¢n d√¢n"],
      correct: 0,
      explanation: "ƒê√¢y l√† n·ªÅn t·∫£ng t∆∞ t∆∞·ªüng ƒë·ªÉ th·ª±c hi·ªán nhi·ªám v·ª• s·ªëng c√≤n: x√¢y d·ª±ng ƒê·∫£ng th·∫≠t s·ª± trong s·∫°ch, v·ªØng m·∫°nh.",
      timeLimit: 48
    },
    {
      question: "Trong t∆∞ t∆∞·ªüng H·ªì Ch√≠ Minh, 'ho√†n thi·ªán c∆° ch·∫ø ki·ªÉm so√°t quy·ªÅn l·ª±c, kh√¥ng ƒë·ªÉ x·∫£y ra l·∫°m quy·ªÅn' k·∫øt h·ª£p v·ªõi 'ph√°t huy vai tr√≤ gi√°m s√°t c·ªßa nh√¢n d√¢n, b√°o ch√≠, c√°c t·ªï ch·ª©c x√£ h·ªôi' t·∫°o n√™n h·ªá th·ªëng g√¨?",
      answers: ["Ki·ªÉm so√°t quy·ªÅn l·ª±c to√†n di·ªán", "Gi√°m s√°t h√†nh ch√≠nh", "Ph·∫£n bi·ªán x√£ h·ªôi", "D√¢n ch·ªß tr·ª±c ti·∫øp"],
      correct: 0,
      explanation: "T·∫°o n√™n h·ªá th·ªëng ki·ªÉm so√°t quy·ªÅn l·ª±c to√†n di·ªán, ƒëa chi·ªÅu t·ª´ trong ra ngo√†i.",
      timeLimit: 54
    },
    {
      question: "H·ªì Ch√≠ Minh kh·∫≥ng ƒë·ªãnh 'x√¢y d·ª±ng ch√≠nh quy·ªÅn ƒëi·ªán t·ª≠, n√¢ng cao ch·∫•t l∆∞·ª£ng ph·ª•c v·ª• nh√¢n d√¢n' trong b·ªëi c·∫£nh 'ƒë∆°n gi·∫£n h√≥a th·ªß t·ª•c h√†nh ch√≠nh'. ƒê√¢y l√† t∆∞ t∆∞·ªüng ti√™n phong v·ªÅ ƒëi·ªÅu g√¨?",
      answers: ["Hi·ªán ƒë·∫°i h√≥a b·ªô m√°y nh√† n∆∞·ªõc", "Ph√°t tri·ªÉn c√¥ng ngh·ªá", "C·∫£i c√°ch h√†nh ch√≠nh", "Ph·ª•c v·ª• nh√¢n d√¢n"],
      correct: 0,
      explanation: "Th·ªÉ hi·ªán t∆∞ t∆∞·ªüng ti√™n phong v·ªÅ hi·ªán ƒë·∫°i h√≥a b·ªô m√°y nh√† n∆∞·ªõc ph·ª•c v·ª• nh√¢n d√¢n hi·ªáu qu·∫£.",
      timeLimit: 51
    },
    {
      question: "Theo H·ªì Ch√≠ Minh, 'b·∫£o v·ªá uy t√≠n, vai tr√≤ l√£nh ƒë·∫°o c·ªßa ƒê·∫£ng' th√¥ng qua vi·ªác 'ph√≤ng, ch·ªëng tham nh≈©ng' v√† 't·∫°o m√¥i tr∆∞·ªùng x√£ h·ªôi c√¥ng b·∫±ng, minh b·∫°ch' th·ªÉ hi·ªán quy lu·∫≠t n√†o?",
      answers: ["Uy t√≠n ƒê·∫£ng g·∫Øn v·ªõi s·ª± trong s·∫°ch", "L√£nh ƒë·∫°o g·∫Øn v·ªõi ph·ª•c v·ª•", "Quy·ªÅn l·ª±c g·∫Øn v·ªõi tr√°ch nhi·ªám", "ƒê·∫°o ƒë·ª©c g·∫Øn v·ªõi nƒÉng l·ª±c"],
      correct: 0,
      explanation: "Th·ªÉ hi·ªán quy lu·∫≠t: uy t√≠n, vai tr√≤ l√£nh ƒë·∫°o c·ªßa ƒê·∫£ng g·∫Øn li·ªÅn v·ªõi s·ª± trong s·∫°ch, v·ªØng m·∫°nh.",
      timeLimit: 56
    }
  ]
};

const enemyTypes = ["üè∞", "‚öîÔ∏è", "üõ°Ô∏è", "üëë", "üè¥‚Äç‚ò†Ô∏è", "‚ö°", "üî•", "üíÄ"];
const bossTypes = ["üêâ", "üëπ", "üíÄ", "üë∫", "üî•", "‚ö°"];

// Sound UI binding
const btnSound = document.getElementById('toggle-sound');
const volSlider = document.getElementById('volume');

function enableSoundOnce() {
  if (!SND.enabled) {
    SND.init();
    SND.startB
    SND.startBGM();
    if (btnSound) {
      btnSound.textContent = 'üîá Mute';
      btnSound.style.background = '#e67e22';
    }
  }
}

if (btnSound) {
  btnSound.addEventListener('click', () => {
    if (!SND.enabled) {
      enableSoundOnce();
    } else {
      if (SND.master.gain.value > 0) {
        SND.setVolume(0);
        btnSound.textContent = 'üîä Unmute';
        btnSound.style.background = '#2ecc71';
      } else {
        const v = parseFloat(volSlider?.value || '0.6');
        SND.setVolume(v);
        btnSound.textContent = 'üîá Mute';
        btnSound.style.background = '#e67e22';
      }
    }
  });
}

if (volSlider) {
  volSlider.addEventListener('input', (e) => {
    const v = parseFloat(e.target.value);
    if (SND.enabled) SND.setVolume(v);
  });
}

['keydown','mousedown','touchstart'].forEach(evt => {
  window.addEventListener(evt, () => enableSoundOnce(), { once: true });
});

// Event listeners
document.addEventListener('keydown', (e) => { keys[e.key.toLowerCase()] = true; });
document.addEventListener('keyup',   (e) => { keys[e.key.toLowerCase()] = false; });
document.addEventListener('click', (e) => {
  if (!questionActive && gameRunning) {
    shootBullet(e.clientX, e.clientY);
    SND.shoot();
  }
});

// Difficulty management - C·∫≠p nh·∫≠t v·ªõi ng∆∞·ª°ng ƒëi·ªÉm m·ªõi
function getCurrentDifficulty() {
  if (score >= 3500) return 'nightmare';  // Nightmare t·ª´ 3500 ƒëi·ªÉm
  if (score >= 2000) return 'expert';     // Expert t·ª´ 2000 ƒëi·ªÉm  
  if (score >= 1000) return 'hard';       // Hard t·ª´ 1000 ƒëi·ªÉm
  if (score >= 500) return 'medium';      // Medium t·ª´ 500 ƒëi·ªÉm
  return 'easy';                          // D·ªÖ t·ª´ 0-499 ƒëi·ªÉm
}

function updateDifficultyDisplay() {
  const difficulty = getCurrentDifficulty();
  const difficultyNames = {
    'easy': 'D·ªÖ',
    'medium': 'Trung b√¨nh', 
    'hard': 'Kh√≥',
    'expert': 'Chuy√™n gia',
    'nightmare': '√Åc m·ªông'
  };
  document.getElementById('difficulty-level').textContent = difficultyNames[difficulty];
  
  const difficultyColors = {
    'easy': '#2ecc71',
    'medium': '#f39c12',
    'hard': '#e74c3c', 
    'expert': '#9b59b6',
    'nightmare': '#ff0066'
  };
  document.getElementById('difficulty-level').style.color = difficultyColors[difficulty];
}

// Utility function to shuffle array
function shuffleArray(array) {
  const shuffled = [...array];
  for (let i = shuffled.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
  }
  return shuffled;
}

// Initialize game
function initGame() {
  player.x = window.innerWidth / 2 - 25;
  player.y = window.innerHeight - 100;
  updatePlayerPosition();
  updateUI();
  updateDifficultyDisplay();
  
  gameLoop();
}

function updatePlayerPosition() {
  const playerEl = document.getElementById('player');
  playerEl.style.left = player.x + 'px';
  playerEl.style.top  = player.y + 'px';
}

function updateUI() {
  document.getElementById('health-text').textContent = Math.max(0, player.health);
  document.getElementById('spirit-text').textContent = Math.max(0, player.spirit);
  document.getElementById('score').textContent = score;
  document.getElementById('wave').textContent = wave;
  document.getElementById('health-bar').style.width = Math.max(0, player.health) + '%';
  document.getElementById('spirit-bar').style.width = Math.max(0, player.spirit) + '%';
  updateDifficultyDisplay();
}

function handlePlayerMovement() {
  if (!gameRunning || questionActive) return;
  const speed = 5;
  if (keys['w'] || keys['arrowup'])    player.y = Math.max(0, player.y - speed);
  if (keys['s'] || keys['arrowdown'])  player.y = Math.min(window.innerHeight - 50, player.y + speed);
  if (keys['a'] || keys['arrowleft'])  player.x = Math.max(0, player.x - speed);
  if (keys['d'] || keys['arrowright']) player.x = Math.min(window.innerWidth - 50, player.x + speed);
  updatePlayerPosition();
}

function spawnEnemy() {
  if (!gameRunning || questionActive) return;
  
  // Boss spawn every 10 waves
  if (wave % 10 === 0 && !bossActive) {
    spawnBoss();
    return;
  }
  
  const enemyHealth = Math.floor(1 + wave / 3);  // TƒÉng m√°u qu√°i nhanh h∆°n
  const enemyCount = Math.min(5, Math.floor(wave / 2) + 1);  // Nhi·ªÅu qu√°i h∆°n
  
  for (let i = 0; i < enemyCount; i++) {
    const enemy = {
      id: Date.now() + Math.random() + i,
      x: Math.random() * (window.innerWidth - 40),
      y: -40 - (i * 80),
      health: enemyHealth,
      maxHealth: enemyHealth,
      type: enemyTypes[Math.floor(Math.random() * enemyTypes.length)],
      lastShot: 0,
      speed: Math.min(6, 1.5 + wave * 0.15),  // TƒÉng t·ªëc ƒë·ªô
      isBoss: false
    };
    enemies.push(enemy);
    
    const enemyEl = document.createElement('div');
    enemyEl.className = 'enemy';
    enemyEl.id = 'enemy_' + enemy.id;
    enemyEl.textContent = enemy.type;
    enemyEl.style.left = enemy.x + 'px';
    enemyEl.style.top  = enemy.y + 'px';
    
    if (enemy.health > 1) {
      enemyEl.style.fontSize = (35 + enemy.health * 3) + 'px';
      enemyEl.style.filter = `drop-shadow(0 0 ${8 + enemy.health * 2}px rgba(255,0,0,0.8))`;
    }
    
    document.getElementById('battlefield').appendChild(enemyEl);
  }
}

function spawnBoss() {
  bossActive = true;
  SND.bossWarning();
  
  const boss = {
    id: Date.now() + Math.random(),
    x: window.innerWidth / 2 - 40,
    y: -80,
    health: Math.floor(20 + wave * 3),  // Boss c√≥ nhi·ªÅu m√°u
    maxHealth: Math.floor(20 + wave * 3),
    type: bossTypes[Math.floor(Math.random() * bossTypes.length)],
    lastShot: 0,
    speed: Math.min(3, 1 + wave * 0.05),
    isBoss: true,
    shootPattern: 0
  };
  enemies.push(boss);
  
  const bossEl = document.createElement('div');
  bossEl.className = 'boss-enemy';
  bossEl.id = 'enemy_' + boss.id;
  bossEl.textContent = boss.type;
  bossEl.style.left = boss.x + 'px';
  bossEl.style.top = boss.y + 'px';
  
  document.getElementById('battlefield').appendChild(bossEl);
  
  // Boss warning indicator
  const warning = document.createElement('div');
  warning.className = 'wave-indicator';
  warning.textContent = `‚ö†Ô∏è BOSS XU·∫§T HI·ªÜN! ‚ö†Ô∏è`;
  warning.style.color = '#ff0066';
  document.body.appendChild(warning);
  setTimeout(() => warning.remove(), 3000);
}

function updateEnemies() {
  enemies.forEach((enemy, index) => {
    enemy.y += enemy.speed;
    const enemyEl = document.getElementById('enemy_' + enemy.id);
    if (enemyEl) enemyEl.style.top = enemy.y + 'px';

    if (enemy.y > window.innerHeight) {
      removeEnemy(index);
      if (enemy.isBoss) bossActive = false;
      player.health -= (enemy.isBoss ? 30 : 10);
    }

    // Enhanced enemy shooting patterns
    const shootChance = enemy.isBoss ? 0.1 : Math.min(0.08, 0.02 + wave * 0.003);
    const shootCooldown = enemy.isBoss ? (2000 - wave * 50) : (3000 - wave * 80);
    
    if (Date.now() - enemy.lastShot > shootCooldown && Math.random() < shootChance) {
      if (enemy.isBoss) {
        shootBossPattern(enemy);
      } else {
        shootEnemyBullet(enemy.x + 20, enemy.y + 20);
      }
      enemy.lastShot = Date.now();
    }

    // Collision detection
    const collisionDistance = enemy.isBoss ? 60 : 40;
    if (Math.abs(enemy.x - player.x) < collisionDistance && Math.abs(enemy.y - player.y) < collisionDistance) {
      removeEnemy(index);
      if (enemy.isBoss) bossActive = false;
      player.health -= (enemy.isBoss ? 50 : 20 + enemy.health * 5);
      createExplosion(enemy.x, enemy.y, enemy.isBoss);
    }
  });
}

function shootBossPattern(boss) {
  // Boss b·∫Øn theo pattern ph·ª©c t·∫°p
  const patterns = [
    // Pattern 1: B·∫Øn th·∫≥ng
    () => shootBossBullet(boss.x + 40, boss.y + 40, 0, 4),
    // Pattern 2: B·∫Øn t√°n x·∫°
    () => {
      for (let i = -2; i <= 2; i++) {
        setTimeout(() => shootBossBullet(boss.x + 40, boss.y + 40, i * 0.5, 3), i * 100);
      }
    },
    // Pattern 3: B·∫Øn theo h∆∞·ªõng player
    () => {
      const dx = player.x - boss.x;
      const dy = player.y - boss.y;
      const distance = Math.sqrt(dx * dx + dy * dy);
      shootBossBullet(boss.x + 40, boss.y + 40, (dx / distance) * 2, (dy / distance) * 3);
    }
  ];
  
  patterns[boss.shootPattern % patterns.length]();
  boss.shootPattern++;
}

function shootBossBullet(x, y, vx, vy) {
  const bullet = {
    id: Date.now() + Math.random(),
    x: x, y: y,
    vx: vx, vy: vy
  };
  enemyBullets.push(bullet);
  
  const bulletEl = document.createElement('div');
  bulletEl.className = 'boss-bullet';
  bulletEl.id = 'enemybullet_' + bullet.id;
  bulletEl.style.left = bullet.x + 'px';
  bulletEl.style.top = bullet.y + 'px';
  document.getElementById('battlefield').appendChild(bulletEl);

  SND._tone({ freq: 300, type: 'sawtooth', dur: 0.06, vol: 0.4 });
}

function shootBullet(targetX, targetY) {
  if (player.spirit < 5) return;
  player.spirit -= 5;
  const dx = targetX - (player.x + 25);
  const dy = targetY - (player.y + 25);
  const distance = Math.sqrt(dx * dx + dy * dy);
  const bullet = {
    id: Date.now() + Math.random(),
    x: player.x + 25,
    y: player.y + 25,
    vx: (dx / distance) * 8,
    vy: (dy / distance) * 8
  };
  bullets.push(bullet);
  const bulletEl = document.createElement('div');
  bulletEl.className = 'bullet';
  bulletEl.id = 'bullet_' + bullet.id;
  bulletEl.style.left = bullet.x + 'px';
  bulletEl.style.top  = bullet.y + 'px';
  document.getElementById('battlefield').appendChild(bulletEl);
}

function shootEnemyBullet(x, y) {
  const dx = player.x - x;
  const dy = player.y - y;
  const distance = Math.sqrt(dx * dx + dy * dy);
  const speed = Math.min(6, 2.5 + wave * 0.15);  // TƒÉng t·ªëc ƒë·∫°n
  
  const bullet = {
    id: Date.now() + Math.random(),
    x: x, y: y,
    vx: (dx / distance) * speed,
    vy: (dy / distance) * speed
  };
  enemyBullets.push(bullet);
  const bulletEl = document.createElement('div');
  bulletEl.className = 'enemy-bullet';
  bulletEl.id = 'enemybullet_' + bullet.id;
  bulletEl.style.left = bullet.x + 'px';
  bulletEl.style.top  = bullet.y + 'px';
  document.getElementById('battlefield').appendChild(bulletEl);

  SND._tone({ freq: 400, type: 'square', dur: 0.04, vol: 0.25 });
}

function updateBullets() {
  // Player bullets
  bullets.forEach((bullet, bulletIndex) => {
    bullet.x += bullet.vx;
    bullet.y += bullet.vy;
    const bulletEl = document.getElementById('bullet_' + bullet.id);
    if (bulletEl) {
      bulletEl.style.left = bullet.x + 'px';
      bulletEl.style.top  = bullet.y + 'px';
    }
    enemies.forEach((enemy, enemyIndex) => {
      const hitDistance = enemy.isBoss ? 50 : 25;
      if (Math.abs(bullet.x - enemy.x - (enemy.isBoss ? 40 : 20)) < hitDistance &&
          Math.abs(bullet.y - enemy.y - (enemy.isBoss ? 40 : 20)) < hitDistance) {
        enemy.health--;
        removeBullet(bulletIndex);
        createExplosion(enemy.x, enemy.y, enemy.isBoss);
        
        if (enemy.health <= 0) {
          removeEnemy(enemyIndex);
          if (enemy.isBoss) {
            bossActive = false;
            SND.bossExplosion();
            score += (100 * Math.max(1, Math.floor(wave / 5)));
            
            // Boss death triggers question
            showQuestion();
          } else {
            score += (15 * Math.max(1, Math.floor(wave / 3)));
            
            // Higher chance for questions on higher difficulties
            const questionChances = {
              'easy': 0.3,
              'medium': 0.4,
              'hard': 0.5,
              'expert': 0.6,
              'nightmare': 0.7
            };
            const difficulty = getCurrentDifficulty();
            if (Math.random() < questionChances[difficulty]) {
              showQuestion();
            }
          }
          
          // Wave progression - faster waves
          if (score > 0 && score % (80 + wave * 30) === 0) {
            wave++;
            showWaveIndicator();
          }
        }
      }
    });
    if (bullet.x < 0 || bullet.x > window.innerWidth ||
        bullet.y < 0 || bullet.y > window.innerHeight) {
      removeBullet(bulletIndex);
    }
  });

  // Enemy bullets
  enemyBullets.forEach((bullet, bulletIndex) => {
    bullet.x += bullet.vx;
    bullet.y += bullet.vy;
    const bulletEl = document.getElementById('enemybullet_' + bullet.id);
    if (bulletEl) {
      bulletEl.style.left = bullet.x + 'px';
      bulletEl.style.top  = bullet.y + 'px';
    }
    if (Math.abs(bullet.x - player.x - 25) < 25 &&
        Math.abs(bullet.y - player.y - 25) < 25) {
      removeEnemyBullet(bulletIndex);
      player.health -= (20 + Math.floor(wave / 2));
      createExplosion(player.x, player.y);
    }
    if (bullet.x < 0 || bullet.x > window.innerWidth ||
        bullet.y < 0 || bullet.y > window.innerHeight) {
      removeEnemyBullet(bulletIndex);
    }
  });
}

function showWaveIndicator() {
  const indicator = document.createElement('div');
  indicator.className = 'wave-indicator';
  
  if (wave % 10 === 0) {
    indicator.textContent = `üêâ BOSS WAVE ${wave} üêâ`;
    indicator.style.color = '#ff0066';
  } else {
    indicator.textContent = `üåä L√†n ${wave} üåä`;
  }
  
  document.body.appendChild(indicator);
  setTimeout(() => indicator.remove(), 2000);
}

function removeBullet(index) {
  if (bullets[index]) {
    const bulletEl = document.getElementById('bullet_' + bullets[index].id);
    if (bulletEl) bulletEl.remove();
    bullets.splice(index, 1);
  }
}

function removeEnemyBullet(index) {
  if (enemyBullets[index]) {
    const bulletEl = document.getElementById('enemybullet_' + enemyBullets[index].id);
    if (bulletEl) bulletEl.remove();
    enemyBullets.splice(index, 1);
  }
}

function removeEnemy(index) {
  if (enemies[index]) {
    const enemyEl = document.getElementById('enemy_' + enemies[index].id);
    if (enemyEl) enemyEl.remove();
    enemies.splice(index, 1);
  }
}

function createExplosion(x, y, isBoss = false) {
  if (isBoss) {
    SND.bossExplosion();
  } else {
    SND.explosion();
  }
  
  const explosion = document.createElement('div');
  explosion.className = 'explosion';
  explosion.textContent = isBoss ? 'üí•üí•üí•' : 'üí•';
  explosion.style.left = x + 'px';
  explosion.style.top  = y + 'px';
  explosion.style.fontSize = isBoss ? '80px' : '60px';
  document.getElementById('battlefield').appendChild(explosion);
  setTimeout(() => { if (explosion.parentNode) explosion.remove(); }, 500);
}

function showQuestion() {
  SND.popup();
  
  const difficulty = getCurrentDifficulty();
  currentDifficulty = difficulty;
  
  const difficultyLevels = ['easy', 'medium', 'hard', 'expert', 'nightmare'];
  if (difficultyLevels.indexOf(difficulty) > difficultyLevels.indexOf(maxDifficultyReached)) {
    maxDifficultyReached = difficulty;
  }
  
  const questionPool = questions[difficulty];
  const randomIndex = Math.floor(Math.random() * questionPool.length);
  const question = questionPool[randomIndex];
  
  questionActive = true;
  questionTimeLeft = question.timeLimit;
  
  const difficultyNames = {
    'easy': 'D·ªÑ',
    'medium': 'TRUNG B√åNH',
    'hard': 'KH√ì', 
    'expert': 'CHUY√äN GIA',
    'nightmare': '√ÅC M·ªòNG'
  };
  
  const difficultyClasses = {
    'easy': 'difficulty-easy',
    'medium': 'difficulty-medium',
    'hard': 'difficulty-hard',
    'expert': 'difficulty-expert',
    'nightmare': 'difficulty-nightmare'
  };
  
  const indicator = document.getElementById('difficulty-indicator');
  indicator.textContent = `üéØ ${difficultyNames[difficulty]} üéØ`;
  indicator.className = `difficulty-indicator ${difficultyClasses[difficulty]}`;
  
  document.getElementById('question-text').textContent = question.question;
  
  // Shuffle answers and track correct position
  const answersWithIndex = question.answers.map((answer, index) => ({
    text: answer,
    isCorrect: index === question.correct
  }));
  
  const shuffledAnswers = shuffleArray(answersWithIndex);
  const newCorrectIndex = shuffledAnswers.findIndex(answer => answer.isCorrect);
  
  const optionsContainer = document.getElementById('answer-options');
  optionsContainer.innerHTML = '';
  shuffledAnswers.forEach((answer, index) => {
    const button = document.createElement('button');
    button.className = 'answer-btn';
    button.textContent = answer.text;
    button.onclick = () => selectAnswer(index, { ...question, correct: newCorrectIndex });
    optionsContainer.appendChild(button);
  });
  
  document.getElementById('explanation').style.display = 'none';
  document.getElementById('question-popup').style.display = 'block';
  
  startQuestionTimer(question);
}

function startQuestionTimer(question) {
  const timerFill = document.getElementById('timer-fill');
  timerFill.style.width = '100%';
  
  questionTimer = setInterval(() => {
    questionTimeLeft--;
    const percentage = (questionTimeLeft / question.timeLimit) * 100;
    timerFill.style.width = percentage + '%';
    
    if (questionTimeLeft <= 0) {
      clearInterval(questionTimer);
      timeoutQuestion(question);
    }
  }, 1000);
}

function timeoutQuestion(question) {
  SND.timeout();
  
  const buttons = document.querySelectorAll('.answer-btn');
  buttons.forEach(btn => btn.disabled = true);
  buttons[question.correct].classList.add('correct');
  
  player.health -= 20;  // Penalty tƒÉng cho timeout
  
  document.getElementById('explanation').textContent = 
    `‚è∞ H·∫øt th·ªùi gian! ${question.explanation}`;
  document.getElementById('explanation').style.display = 'block';
  
  setTimeout(() => {
    document.getElementById('question-popup').style.display = 'none';
    questionActive = false;
  }, 3000);
}

function selectAnswer(selectedIndex, question) {
  if (questionTimer) {
    clearInterval(questionTimer);
    questionTimer = null;
  }
  
  const buttons = document.querySelectorAll('.answer-btn');
  buttons.forEach(btn => btn.disabled = true);

  const difficultyMultipliers = {
    'easy': 1,
    'medium': 1.5,
    'hard': 2,
    'expert': 3,
    'nightmare': 4
  };
  
  const multiplier = difficultyMultipliers[currentDifficulty];

  if (selectedIndex === question.correct) {
    buttons[selectedIndex].classList.add('correct');
    
    const timeBonus = Math.floor((questionTimeLeft / question.timeLimit) * 30);
    const healthReward = Math.floor((25 + timeBonus) * multiplier);
    const spiritReward = Math.floor((35 + timeBonus) * multiplier);
    const scoreReward = Math.floor((75 + timeBonus * 3) * multiplier);
    
    player.health = Math.min(100, player.health + healthReward);
    player.spirit = Math.min(100, player.spirit + spiritReward);
    score += scoreReward;
    
    SND.correct();
    
    document.getElementById('explanation').textContent = 
      `‚úÖ Ch√≠nh x√°c! +${healthReward} m√°u, +${spiritReward} tinh th·∫ßn, +${scoreReward} ƒëi·ªÉm. ${question.explanation}`;
  } else {
    buttons[selectedIndex].classList.add('incorrect');
    buttons[question.correct].classList.add('correct');
    
    const healthPenalty = Math.floor(15 * multiplier);
    player.health -= healthPenalty;
    
    SND.incorrect();
    
    document.getElementById('explanation').textContent = 
      `‚ùå Sai r·ªìi! -${healthPenalty} m√°u. ${question.explanation}`;
  }

  document.getElementById('explanation').style.display = 'block';

  setTimeout(() => {
    document.getElementById('question-popup').style.display = 'none';
    questionActive = false;
  }, 4000);
}

function checkGameOver() {
  if (player.health <= 0) {
    gameRunning = false;
    document.getElementById('final-score').textContent = score;
    document.getElementById('final-wave').textContent = wave;
    
    const difficultyNames = {
      'easy': 'D·ªÖ',
      'medium': 'Trung b√¨nh',
      'hard': 'Kh√≥',
      'expert': 'Chuy√™n gia',
      'nightmare': '√Åc m·ªông'
    };
    document.getElementById('final-difficulty').textContent = difficultyNames[maxDifficultyReached];
    
    document.getElementById('game-over').style.display = 'flex';
    SND.gameover();
    SND.stopBGM();
  }
}

function restartGame() {
  player = { x: window.innerWidth / 2 - 25, y: window.innerHeight - 100, health: 100, spirit: 100 };
  enemies = [];
  bullets = [];
  enemyBullets = [];
  score = 0;
  wave = 1;
  gameRunning = true;
  questionActive = false;
  currentQuestionIndex = 0;
  currentDifficulty = 'easy';
  maxDifficultyReached = 'easy';
  bossActive = false;
  
  if (questionTimer) {
    clearInterval(questionTimer);
    questionTimer = null;
  }

  const battlefield = document.getElementById('battlefield');
  Array.from(battlefield.children).forEach(child => {
    if (child.id !== 'player') child.remove();
  });

  document.getElementById('game-over').style.display = 'none';
  updatePlayerPosition();
  updateUI();

  if (SND.enabled) SND.startBGM();
}

function gameLoop() {
  if (!gameRunning) { requestAnimationFrame(gameLoop); return; }
  
  handlePlayerMovement();
  updateEnemies();
  updateBullets();

  // Spirit regeneration
  if (player.spirit < 100) player.spirit = Math.min(100, player.spirit + 0.4);

  // Dynamic enemy spawning based on wave
  const spawnInterval = Math.max(400, 1500 - (wave * 60)); // Spawn nhanh h∆°n
  if (Date.now() - lastEnemySpawn > spawnInterval) {
    spawnEnemy();
    lastEnemySpawn = Date.now();
  }

  updateUI();
  checkGameOver();
  requestAnimationFrame(gameLoop);
}

window.addEventListener('load', () => { 
  initGame(); 
  lastEnemySpawn = Date.now();
});
</script>
</body>
</html>
